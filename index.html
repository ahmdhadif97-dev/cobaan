import { useState, useEffect, useRef } from "react";
import { Star } from "lucide-react";

export default function NumberCounter() {
  const [displayed, setDisplayed] = useState(1); // DN
  const [starred, setStarred] = useState(null); // SN
  const [current, setCurrent] = useState(1); // CN (fixed for now)
  const containerRef = useRef(null);

  const itemHeight = 50; // px
  const totalNumbers = 300;
  const numbers = Array.from({ length: totalNumbers }, (_, i) => i + 1);

  // Scroll to value helper
  const scrollToValue = (value, smooth = true) => {
    if (!containerRef.current) return;
    const targetIndex = value - 1;
    const scrollTop =
      targetIndex * itemHeight -
      (containerRef.current.clientHeight / 2 - itemHeight / 2);
    containerRef.current.scrollTo({
      top: scrollTop,
      behavior: smooth ? "smooth" : "auto",
    });
  };

  // Center on first number at mount
  useEffect(() => {
    scrollToValue(1, false);
  }, []);

  // Update displayed number when scrolling
  const handleScroll = () => {
    if (!containerRef.current) return;
    const center =
      containerRef.current.scrollTop + containerRef.current.clientHeight / 2;
    const index = Math.round(center / itemHeight);
    const newValue = Math.min(totalNumbers, Math.max(1, index + 1));
    setDisplayed(newValue);
  };

  // Search handler
  const handleKeyDown = (e) => {
    if (e.key === "Enter") {
      const inputValue = parseInt(e.target.value, 10);
      if (inputValue >= 1 && inputValue <= totalNumbers) {
        setDisplayed(inputValue);
        scrollToValue(inputValue);
      }
    }
  };

  return (
    <div className="flex flex-col items-center justify-center h-screen bg-gray-50">
      {/* Search Box */}
      <input
        type="number"
        placeholder="Go to number..."
        className="mb-4 p-2 border rounded"
        onKeyDown={handleKeyDown}
      />

      <div className="flex gap-6 items-center">
        {/* Info Left */}
        <div className="text-sm text-left">
          <div>Current Number = {String(current).padStart(4, "0")}</div>
          <div>
            Starred ={" "}
            {starred ? String(starred).padStart(4, "0") : "None"}
          </div>
          {starred && (
            <div>
              {Math.abs(starred - current)} turns more
            </div>
          )}
        </div>

        {/* Number List */}
        <div
          ref={containerRef}
          onScroll={handleScroll}
          className="h-[350px] w-[120px] overflow-y-scroll no-scrollbar text-center"
        >
          {numbers.map((num) => (
            <div
              key={num}
              className={`h-[50px] flex items-center justify-center ${
                num === displayed
                  ? "text-black font-bold text-2xl"
                  : "text-gray-400 text-lg"
              }`}
            >
              {String(num).padStart(4, "0")}
              {num === displayed && (
                <button
                  onClick={() =>
                    setStarred(starred === num ? null : num)
                  }
                  className="ml-2 p-1 rounded bg-yellow-200 hover:bg-yellow-300"
                >
                  <Star
                    className={`w-4 h-4 ${
                      starred === num ? "fill-black" : ""
                    }`}
                  />
                </button>
              )}
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}
