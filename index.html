import { useState, useRef } from "react";

export default function NumberCounter() {
  const [current, setCurrent] = useState(1);
  const [skipped, setSkipped] = useState([]);
  const scrollRef = useRef(null);
  const totalNumbers = 12;

  // Generate numbers from 1 to totalNumbers
  const numbers = Array.from({ length: totalNumbers }, (_, i) => i + 1);

  const handleScroll = () => {
    if (!scrollRef.current) return;
    const { scrollTop, clientHeight } = scrollRef.current;
    const scrollCenter = scrollTop + clientHeight / 2;
    
    // Find which number is at the center
    const centerIndex = Math.round(scrollCenter / 50) - 1;
    const newDisplayed = Math.max(1, Math.min(totalNumbers, centerIndex + 1));
  };

  const scrollToNumber = (num) => {
    if (scrollRef.current) {
      scrollRef.current.scrollTo({
        top: (num - 1) * 50 - scrollRef.current.clientHeight / 2 + 25,
        behavior: "smooth"
      });
    }
  };

  const handleConfirm = () => {
    if (current < totalNumbers) {
      setCurrent(prev => prev + 1);
      scrollToNumber(current + 1);
    }
  };

  const handleSkip = () => {
    if (current < totalNumbers) {
      setSkipped(prev => [...prev, current]);
      setCurrent(prev => prev + 1);
      scrollToNumber(current + 1);
    }
  };

  // Initialize scroll position
  useEffect(() => {
    scrollToNumber(1);
  }, []);

  return (
    <div style={{ 
      display: "flex", 
      flexDirection: "column", 
      alignItems: "center",
      height: "100vh",
      justifyContent: "center"
    }}>
      <div
        ref={scrollRef}
        onScroll={handleScroll}
        style={{
          height: "350px",
          width: "120px",
          overflowY: "scroll",
          scrollSnapType: "y mandatory",
          position: "relative",
          scrollbarWidth: "thin",
          scrollbarColor: "#ccc transparent",
          msOverflowStyle: "none",
        }}
      >
        <div style={{ 
          position: "relative",
          padding: "150px 0" // Extra space for centering
        }}>
          {numbers.map((num) => {
            const isCurrent = num === current;
            const isSkipped = skipped.includes(num);
            
            return (
              <div
                key={num}
                style={{
                  height: "50px",
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  scrollSnapAlign: "center",
                  fontFamily: "monospace",
                  color: isSkipped ? "#ff4444" : "#333",
                  fontSize: "16px",
                  fontWeight: "normal",
                  textDecoration: isSkipped ? "line-through" : "none",
                  backgroundColor: isCurrent ? "#007bff" : "transparent",
                  color: isCurrent ? "white" : isSkipped ? "#ff4444" : "#333",
                  position: "relative",
                  transform: "scale(1)",
                  transition: "all 0.2s ease",
                }}
              >
                {String(num).padStart(4, "0")}
                
                {/* Display action buttons when scrolled to this number */}
                <div style={{
                  position: "absolute",
                  right: "-60px",
                  display: "flex",
                  gap: "8px",
                  opacity: 0,
                  transition: "opacity 0.2s ease"
                }}>
                  <button
                    onClick={handleConfirm}
                    style={{
                      width: "24px",
                      height: "24px",
                      borderRadius: "50%",
                      background: "#28a745",
                      color: "white",
                      border: "none",
                      cursor: "pointer",
                      display: "flex",
                      alignItems: "center",
                      justifyContent: "center",
                      fontSize: "14px"
                    }}
                  >
                    ✓
                  </button>
                  <button
                    onClick={handleSkip}
                    style={{
                      width: "24px",
                      height: "24px",
                      borderRadius: "50%",
                      background: "#dc3545",
                      color: "white",
                      border: "none",
                      cursor: "pointer",
                      display: "flex",
                      alignItems: "center",
                      justifyContent: "center",
                      fontSize: "14px"
                    }}
                  >
                    ✕
                  </button>
                </div>
              </div>
            );
          })}
        </div>
      </div>

      <style>{`
        .scroll-container::-webkit-scrollbar {
          width: 4px;
        }
        .scroll-container::-webkit-scrollbar-thumb {
          background: #ccc;
          border-radius: 2px;
        }
        .scroll-container::-webkit-scrollbar-thumb:hover {
          background: #aaa;
        }
        .scroll-container::-webkit-scrollbar-track {
          background: transparent;
        }
      `}</style>
    </div>
  );
}
