import { useState, useRef, useEffect } from "react";

export default function NumberCounter() {
  const [current, setCurrent] = useState(1);
  const [displayed, setDisplayed] = useState(1);
  const [skipped, setSkipped] = useState([]);
  const scrollRef = useRef(null);
  const totalNumbers = 12;
  const numberHeight = 50;

  const numbers = Array.from({ length: totalNumbers }, (_, i) => i + 1);

  const handleScroll = () => {
    if (!scrollRef.current) return;
    const { scrollTop, clientHeight } = scrollRef.current;
    const centerPos = scrollTop + clientHeight / 2;
    const newDisplayed = Math.min(
      totalNumbers, 
      Math.max(1, Math.floor(centerPos / numberHeight) + 1)
    );
    setDisplayed(newDisplayed);
  };

  const scrollToNumber = (num) => {
    if (scrollRef.current) {
      scrollRef.current.scrollTo({
        top: (num - 1) * numberHeight - scrollRef.current.clientHeight / 2 + numberHeight / 2,
        behavior: "smooth"
      });
    }
  };

  const handleConfirm = () => {
    if (current < totalNumbers) {
      setCurrent(prev => prev + 1);
      scrollToNumber(current + 1);
    }
  };

  const handleSkip = () => {
    if (current < totalNumbers) {
      setSkipped(prev => [...prev, current]);
      setCurrent(prev => prev + 1);
      scrollToNumber(current + 1);
    }
  };

  useEffect(() => {
    scrollToNumber(1);
  }, []);

  return (
    <div className="counter-container">
      <div 
        ref={scrollRef}
        onScroll={handleScroll}
        className="numbers-scroller"
      >
        <div className="numbers-wrapper">
          {numbers.map((num) => {
            const isCurrent = num === current;
            const isSkipped = skipped.includes(num);
            const isDisplayed = num === displayed;
            
            return (
              <div
                key={num}
                className={`number ${
                  isCurrent ? 'current' : ''
                } ${
                  isSkipped ? 'skipped' : ''
                } ${
                  isDisplayed ? 'displayed' : ''
                }`}
              >
                {String(num).padStart(4, "0")}
                
                {isDisplayed && (
                  <div className="action-buttons">
                    <button 
                      onClick={handleConfirm}
                      className="confirm-btn"
                    >
                      ✓
                    </button>
                    <button 
                      onClick={handleSkip}
                      className="skip-btn"
                    >
                      ✕
                    </button>
                  </div>
                )}
              </div>
            );
          })}
        </div>
      </div>

      <style jsx>{`
        .counter-container {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          height: 100vh;
        }
        
        .numbers-scroller {
          height: 350px;
          width: 140px;
          overflow-y: scroll;
          scroll-snap-type: y mandatory;
          position: relative;
        }
        
        .numbers-scroller::-webkit-scrollbar {
          width: 4px;
        }
        
        .numbers-scroller::-webkit-scrollbar-thumb {
          background: #ccc;
          border-radius: 2px;
        }
        
        .numbers-scroller::-webkit-scrollbar-track {
          background: transparent;
        }
        
        .numbers-wrapper {
          position: relative;
          padding: 150px 0;
        }
        
        .number {
          height: 50px;
          display: flex;
          align-items: center;
          justify-content: center;
          scroll-snap-align: center;
          font-family: monospace;
          color: #999;
          font-size: 14px;
          transition: all 0.2s ease;
          position: relative;
        }
        
        .number.displayed {
          color: #000;
          font-size: 20px;
          font-weight: bold;
        }
        
        .number.current {
          background-color: #007bff;
          color: white;
          border-radius: 4px;
        }
        
        .number.skipped {
          color: #ff4444;
          text-decoration: line-through;
        }
        
        .action-buttons {
          position: absolute;
          right: -60px;
          display: flex;
          gap: 8px;
        }
        
        .confirm-btn, .skip-btn {
          width: 24px;
          height: 24px;
          border-radius: 50%;
          border: none;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 14px;
          transition: transform 0.1s ease;
        }
        
        .confirm-btn {
          background-color: #28a745;
          color: white;
        }
        
        .skip-btn {
          background-color: #dc3545;
          color: white;
        }
        
        .confirm-btn:active, .skip-btn:active {
          transform: scale(0.9);
        }
      `}</style>
    </div>
  );
}
